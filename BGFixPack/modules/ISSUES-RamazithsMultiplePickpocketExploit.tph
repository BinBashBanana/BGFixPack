//ISSUES-RamazithsMultiplePickpocketExploit.tph
PRINT ~Processing ISSUES-RamazithsMultiplePickpocketExploit.tph~
// ----------------------------------------------------------------------------
//Ramazith Pickpocket Exploit Fix
// Prevent multiple pickpockets of Ramazith's pockets -- but you can still pick his pockets
<<<<<<<< inlined/ramazi.d
//These attempt to false the states so that they don't show again.
ADD_TRANS_TRIGGER ramazi 7 ~False()~ DO 2
ADD_TRANS_TRIGGER ramazi 8 ~False()~ DO 0
>>>>>>>>
COMPILE ~inlined/ramazi.d~
<<<<<<<< ramazi/stuffcheck.baf
//stole is set if taken by pick pocket
IF
Exists("Ramazith")
!Global("ab_BGF_bothgone","GLOBAL",1) //not destroyed
!HasItem("ring07","Ramazith") //stolen
!HasItem("amul16","Ramazith") //stolen
THEN
RESPONSE #100
SetGlobal("ab_BGF_bothstole","GLOBAL",1) //to destroy
END

IF
Exists("Ramazith")
!Global("ab_BGF_amulgone","GLOBAL",1) //not destroyed
HasItem("ring07","Ramazith") //still got
!HasItem("amul16","Ramazith") //stolen
THEN
RESPONSE #100
SetGlobal("ab_BGF_amulstole","GLOBAL",1) //to destroy
END

IF
Exists("Ramazith")
!Global("ab_BGF_ringgone","GLOBAL",1) //not destroyed
HasItem("amul16","Ramazith") //still got
!HasItem("ring07","Ramazith") //stolen
THEN
RESPONSE #100
SetGlobal("ab_BGF_ringstole","GLOBAL",1) //to destroy
END

//gone is set if destroyed because was stolen
IF
Exists("Ramazith")
Global("ab_BGF_bothstole","GLOBAL",1) //to destroy
HasItem("ring07","Ramazith") //has but shouldn't
HasItem("amul16","Ramazith") //has but shouldn't
THEN
RESPONSE #100
ActionOverride("Ramazith",DestroyItem("amul16")) //destroy
ActionOverride("Ramazith",DestroyItem("ring07")) //destroy
SetGlobal("ab_BGF_bothgone","GLOBAL",1) //told gone
END

IF
Exists("Ramazith")
Global("ab_BGF_amulstole","GLOBAL",1) //to destroy
HasItem("amul16","Ramazith") //has but shouldn't
THEN
RESPONSE #100
ActionOverride("Ramazith",DestroyItem("amul16")) //destroy
SetGlobal("ab_BGF_amulgone","GLOBAL",1) //told gone
END

IF
Exists("Ramazith")
Global("ab_BGF_ringstole","GLOBAL",1) //to destroy
HasItem("ring07","Ramazith") //has but shouldn't
THEN
RESPONSE #100
ActionOverride("Ramazith",DestroyItem("ring07")) //destroy
SetGlobal("ab_BGF_ringgone","GLOBAL",1) //told gone
END
>>>>>>>>
COPY_EXISTING ~ramazi.cre~ ~override~
 READ_ASCII 0x248 ~or_script~ //find override script
 INNER_ACTION BEGIN
  ACTION_IF (FILE_EXISTS_IN_GAME ~%or_script%.bcs~) THEN BEGIN //see if it's real
   COPY_EXISTING ~%or_script%.bcs~ ~override/abgframi.bcs~ //copy it and give it our name
   EXTEND_BOTTOM ~abgframi.bcs~ ~ramazi/stuffcheck.baf~ //add our stuff
  END ELSE BEGIN //otherwise
   EXTEND_BOTTOM ~abgframi.bcs~ ~ramazi/stuffcheck.baf~ //make new when add our stuff fails
  END
 END
 WRITE_ASCII_TERMINATE 0x248 ~abgframi~ //reassign override script to our value
BUT_ONLY_IF_IT_CHANGES
